614a04598510ed109585c7998dd9b1b5
"use strict";
/**
 * Jest Global Setup
 *
 * This runs once before all test suites start.
 * Use this for expensive setup operations that can be shared across tests.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = globalSetup;
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const child_process_1 = require("child_process");
async function globalSetup() {
    console.log('üöÄ Starting Jest global setup...');
    try {
        // Create necessary test directories
        const testDirs = [
            './tmp/test',
            './test-data',
            './reports/junit',
            './reports/html',
            './coverage',
            './.jest-cache',
        ];
        for (const dir of testDirs) {
            if (!fs.existsSync(dir)) {
                fs.mkdirSync(dir, { recursive: true });
                console.log(`  ‚úÖ Created test directory: ${dir}`);
            }
        }
        // Create test data files
        const testDataDir = './test-data';
        // Mock build history for pipeline tests
        const mockBuildHistory = {
            builds: [
                {
                    id: 'build-1',
                    timestamp: '2024-01-01T00:00:00Z',
                    platform: 'android',
                    success: true,
                    duration: 120000,
                    bundleSize: 1024000,
                    metrics: {
                        jsSize: 500000,
                        assetsSize: 524000,
                        buildTime: 120000,
                        memoryUsage: 256000000,
                    }
                },
                {
                    id: 'build-2',
                    timestamp: '2024-01-01T01:00:00Z',
                    platform: 'ios',
                    success: true,
                    duration: 150000,
                    bundleSize: 1100000,
                    metrics: {
                        jsSize: 550000,
                        assetsSize: 550000,
                        buildTime: 150000,
                        memoryUsage: 280000000,
                    }
                }
            ],
            totalBuilds: 2,
            successRate: 1.0,
            averageDuration: 135000,
        };
        fs.writeFileSync(path.join(testDataDir, 'build-history.json'), JSON.stringify(mockBuildHistory, null, 2));
        // Mock CI configuration templates
        const mockGitHubActions = `name: EchoTrail Mobile CI
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npm test`;
        fs.writeFileSync(path.join(testDataDir, 'github-actions.yml'), mockGitHubActions);
        // Mock package.json for test projects
        const mockPackageJson = {
            name: 'test-project',
            version: '1.0.0',
            scripts: {
                build: 'metro build',
                test: 'jest',
            },
            dependencies: {
                'react-native': '^0.72.0',
                '@react-native/metro-config': '^0.72.0',
            },
            devDependencies: {
                jest: '^29.0.0',
                '@types/jest': '^29.0.0',
            }
        };
        fs.writeFileSync(path.join(testDataDir, 'package.json'), JSON.stringify(mockPackageJson, null, 2));
        // Verify Node.js and npm versions for compatibility warnings
        try {
            const nodeVersion = process.version;
            const npmVersion = (0, child_process_1.execSync)('npm --version', { encoding: 'utf8' }).trim();
            console.log(`  ‚ÑπÔ∏è  Node.js version: ${nodeVersion}`);
            console.log(`  ‚ÑπÔ∏è  npm version: ${npmVersion}`);
            // Check for known compatibility issues
            const nodeMajor = parseInt(nodeVersion.slice(1).split('.')[0]);
            if (nodeMajor < 16) {
                console.warn('  ‚ö†Ô∏è  Warning: Node.js version < 16 may cause issues');
            }
        }
        catch (error) {
            console.warn('  ‚ö†Ô∏è  Could not verify npm version');
        }
        // Initialize test database (in-memory SQLite for tests)
        // This would be where you'd set up a test database if needed
        console.log('  ‚úÖ Test database initialized (in-memory)');
        // Set up test environment variables that need to persist
        process.env.JEST_GLOBAL_SETUP_COMPLETE = 'true';
        process.env.TEST_START_TIME = Date.now().toString();
        // Create performance baseline data
        const performanceBaseline = {
            pipelineInitialization: 100, // ms
            buildExecution: 5000, // ms
            reportGeneration: 200, // ms
            memoryUsage: 100 * 1024 * 1024, // 100MB
            created: new Date().toISOString(),
        };
        fs.writeFileSync(path.join(testDataDir, 'performance-baseline.json'), JSON.stringify(performanceBaseline, null, 2));
        // Validate test environment
        const requiredEnvVars = [
            'NODE_ENV',
            'METRO_TEST_MODE',
            'BUILD_HISTORY_PATH',
        ];
        const missingEnvVars = requiredEnvVars.filter(envVar => !process.env[envVar]);
        if (missingEnvVars.length > 0) {
            throw new Error(`Missing required environment variables: ${missingEnvVars.join(', ')}`);
        }
        // Log test configuration summary
        console.log('  üìä Test Configuration Summary:');
        console.log(`    - Test timeout: ${process.env.TEST_TIMEOUT_MS || '60000'}ms`);
        console.log(`    - Max memory: ${process.env.MAX_MEMORY_MB || '512'}MB`);
        console.log(`    - CI mode: ${process.env.CI === 'true' ? 'Yes' : 'No'}`);
        console.log(`    - Property test runs: ${process.env.PROPERTY_TEST_RUNS || '100'}`);
        console.log(`    - Chaos failure rate: ${process.env.CHAOS_FAILURE_RATE || '0.1'}`);
        console.log('‚úÖ Jest global setup completed successfully');
    }
    catch (error) {
        console.error('‚ùå Jest global setup failed:', error);
        throw error;
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxLZW50aFxcRGVza3RvcFxcZWNob3RyYWlsLXByb2plY3RcXGVjaG90cmFpbFxcYXBwc1xcbW9iaWxlXFxzcmNcXF9fdGVzdHNfX1xcc2V0dXBcXGplc3QuZ2xvYmFsU2V0dXAudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU1ILDhCQWlMQztBQXJMRCx1Q0FBeUI7QUFDekIsMkNBQTZCO0FBQzdCLGlEQUF5QztBQUUxQixLQUFLLFVBQVUsV0FBVztJQUN2QyxPQUFPLENBQUMsR0FBRyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7SUFFaEQsSUFBSSxDQUFDO1FBQ0gsb0NBQW9DO1FBQ3BDLE1BQU0sUUFBUSxHQUFHO1lBQ2YsWUFBWTtZQUNaLGFBQWE7WUFDYixpQkFBaUI7WUFDakIsZ0JBQWdCO1lBQ2hCLFlBQVk7WUFDWixlQUFlO1NBQ2hCLENBQUM7UUFFRixLQUFLLE1BQU0sR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3hCLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7Z0JBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDcEQsQ0FBQztRQUNILENBQUM7UUFFRCx5QkFBeUI7UUFDekIsTUFBTSxXQUFXLEdBQUcsYUFBYSxDQUFDO1FBRWxDLHdDQUF3QztRQUN4QyxNQUFNLGdCQUFnQixHQUFHO1lBQ3ZCLE1BQU0sRUFBRTtnQkFDTjtvQkFDRSxFQUFFLEVBQUUsU0FBUztvQkFDYixTQUFTLEVBQUUsc0JBQXNCO29CQUNqQyxRQUFRLEVBQUUsU0FBUztvQkFDbkIsT0FBTyxFQUFFLElBQUk7b0JBQ2IsUUFBUSxFQUFFLE1BQU07b0JBQ2hCLFVBQVUsRUFBRSxPQUFP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dUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLElBQUksT0FBTyxJQUFJLENBQUMsQ0FBQztRQUMvRSxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDO1FBQ3pFLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQzFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNwRixPQUFPLENBQUMsR0FBRyxDQUFDLDZCQUE2QixPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixJQUFJLEtBQUssRUFBRSxDQUFDLENBQUM7UUFFcEYsT0FBTyxDQUFDLEdBQUcsQ0FBQyw0Q0FBNEMsQ0FBQyxDQUFDO0lBRTVELENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNwRCxNQUFNLEtBQUssQ0FBQztJQUNkLENBQUM7QUFDSCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcS2VudGhcXERlc2t0b3BcXGVjaG90cmFpbC1wcm9qZWN0XFxlY2hvdHJhaWxcXGFwcHNcXG1vYmlsZVxcc3JjXFxfX3Rlc3RzX19cXHNldHVwXFxqZXN0Lmdsb2JhbFNldHVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBKZXN0IEdsb2JhbCBTZXR1cFxyXG4gKiBcclxuICogVGhpcyBydW5zIG9uY2UgYmVmb3JlIGFsbCB0ZXN0IHN1aXRlcyBzdGFydC5cclxuICogVXNlIHRoaXMgZm9yIGV4cGVuc2l2ZSBzZXR1cCBvcGVyYXRpb25zIHRoYXQgY2FuIGJlIHNoYXJlZCBhY3Jvc3MgdGVzdHMuXHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gZ2xvYmFsU2V0dXAoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgY29uc29sZS5sb2coJ/CfmoAgU3RhcnRpbmcgSmVzdCBnbG9iYWwgc2V0dXAuLi4nKTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIENyZWF0ZSBuZWNlc3NhcnkgdGVzdCBkaXJlY3Rvcmllc1xyXG4gICAgY29uc3QgdGVzdERpcnMgPSBbXHJcbiAgICAgICcuL3RtcC90ZXN0JyxcclxuICAgICAgJy4vdGVzdC1kYXRhJyxcclxuICAgICAgJy4vcmVwb3J0cy9qdW5pdCcsXHJcbiAgICAgICcuL3JlcG9ydHMvaHRtbCcsXHJcbiAgICAgICcuL2NvdmVyYWdlJyxcclxuICAgICAgJy4vLmplc3QtY2FjaGUnLFxyXG4gICAgXTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IGRpciBvZiB0ZXN0RGlycykge1xyXG4gICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZGlyKSkge1xyXG4gICAgICAgIGZzLm1rZGlyU3luYyhkaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGAgIOKchSBDcmVhdGVkIHRlc3QgZGlyZWN0b3J5OiAke2Rpcn1gKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWF0ZSB0ZXN0IGRhdGEgZmlsZXNcclxuICAgIGNvbnN0IHRlc3REYXRhRGlyID0gJy4vdGVzdC1kYXRhJztcclxuICAgIFxyXG4gICAgLy8gTW9jayBidWlsZCBoaXN0b3J5IGZvciBwaXBlbGluZSB0ZXN0c1xyXG4gICAgY29uc3QgbW9ja0J1aWxkSGlzdG9yeSA9IHtcclxuICAgICAgYnVpbGRzOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6ICdidWlsZC0xJyxcclxuICAgICAgICAgIHRpbWVzdGFtcDogJzIwMjQtMDEtMDFUMDA6MDA6MDBaJyxcclxuICAgICAgICAgIHBsYXRmb3JtOiAnYW5kcm9pZCcsXHJcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgZHVyYXRpb246IDEyMDAwMCxcclxuICAgICAgICAgIGJ1bmRsZVNpemU6IDEwMjQwMDAsXHJcbiAgICAgICAgICBtZXRyaWNzOiB7XHJcbiAgICAgICAgICAgIGpzU2l6ZTogNTAwMDAwLFxyXG4gICAgICAgICAgICBhc3NldHNTaXplOiA1MjQwMDAsXHJcbiAgICAgICAgICAgIGJ1aWxkVGltZTogMTIwMDAwLFxyXG4gICAgICAgICAgICBtZW1vcnlVc2FnZTogMjU2MDAwMDAwLFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6ICdidWlsZC0yJyxcclxuICAgICAgICAgIHRpbWVzdGFtcDogJzIwMjQtMDEtMDFUMDE6MDA6MDBaJyxcclxuICAgICAgICAgIHBsYXRmb3JtOiAnaW9zJyxcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICBkdXJhdGlvbjogMTUwMDAwLFxyXG4gICAgICAgICAgYnVuZGxlU2l6ZTogMTEwMDAwMCxcclxuICAgICAgICAgIG1ldHJpY3M6IHtcclxuICAgICAgICAgICAganNTaXplOiA1NTAwMDAsXHJcbiAgICAgICAgICAgIGFzc2V0c1NpemU6IDU1MDAwMCxcclxuICAgICAgICAgICAgYnVpbGRUaW1lOiAxNTAwMDAsXHJcbiAgICAgICAgICAgIG1lbW9yeVVzYWdlOiAyODAwMDAwMDAsXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICBdLFxyXG4gICAgICB0b3RhbEJ1aWxkczogMixcclxuICAgICAgc3VjY2Vzc1JhdGU6IDEuMCxcclxuICAgICAgYXZlcmFnZUR1cmF0aW9uOiAxMzUwMDAsXHJcbiAgICB9O1xyXG5cclxuICAgIGZzLndyaXRlRmlsZVN5bmMoXHJcbiAgICAgIHBhdGguam9pbih0ZXN0RGF0YURpciwgJ2J1aWxkLWhpc3RvcnkuanNvbicpLFxyXG4gICAgICBKU09OLnN0cmluZ2lmeShtb2NrQnVpbGRIaXN0b3J5LCBudWxsLCAyKVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBNb2NrIENJIGNvbmZpZ3VyYXRpb24gdGVtcGxhdGVzXHJcbiAgICBjb25zdCBtb2NrR2l0SHViQWN0aW9ucyA9IGBuYW1lOiBFY2hvVHJhaWwgTW9iaWxlIENJXHJcbm9uOiBbcHVzaCwgcHVsbF9yZXF1ZXN0XVxyXG5qb2JzOlxyXG4gIHRlc3Q6XHJcbiAgICBydW5zLW9uOiB1YnVudHUtbGF0ZXN0XHJcbiAgICBzdGVwczpcclxuICAgICAgLSB1c2VzOiBhY3Rpb25zL2NoZWNrb3V0QHYzXHJcbiAgICAgIC0gdXNlczogYWN0aW9ucy9zZXR1cC1ub2RlQHYzXHJcbiAgICAgIC0gcnVuOiBucG0gY2lcclxuICAgICAgLSBydW46IG5wbSB0ZXN0YDtcclxuXHJcbiAgICBmcy53cml0ZUZpbGVTeW5jKFxyXG4gICAgICBwYXRoLmpvaW4odGVzdERhdGFEaXIsICdnaXRodWItYWN0aW9ucy55bWwnKSxcclxuICAgICAgbW9ja0dpdEh1YkFjdGlvbnNcclxuICAgICk7XHJcblxyXG4gICAgLy8gTW9jayBwYWNrYWdlLmpzb24gZm9yIHRlc3QgcHJvamVjdHNcclxuICAgIGNvbnN0IG1vY2tQYWNrYWdlSnNvbiA9IHtcclxuICAgICAgbmFtZTogJ3Rlc3QtcHJvamVjdCcsXHJcbiAgICAgIHZlcnNpb246ICcxLjAuMCcsXHJcbiAgICAgIHNjcmlwdHM6IHtcclxuICAgICAgICBidWlsZDogJ21ldHJvIGJ1aWxkJyxcclxuICAgICAgICB0ZXN0OiAnamVzdCcsXHJcbiAgICAgIH0sXHJcbiAgICAgIGRlcGVuZGVuY2llczoge1xyXG4gICAgICAgICdyZWFjdC1uYXRpdmUnOiAnXjAuNzIuMCcsXHJcbiAgICAgICAgJ0ByZWFjdC1uYXRpdmUvbWV0cm8tY29uZmlnJzogJ14wLjcyLjAnLFxyXG4gICAgICB9LFxyXG4gICAgICBkZXZEZXBlbmRlbmNpZXM6IHtcclxuICAgICAgICBqZXN0OiAnXjI5LjAuMCcsXHJcbiAgICAgICAgJ0B0eXBlcy9qZXN0JzogJ14yOS4wLjAnLFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGZzLndyaXRlRmlsZVN5bmMoXHJcbiAgICAgIHBhdGguam9pbih0ZXN0RGF0YURpciwgJ3BhY2thZ2UuanNvbicpLFxyXG4gICAgICBKU09OLnN0cmluZ2lmeShtb2NrUGFja2FnZUpzb24sIG51bGwsIDIpXHJcbiAgICApO1xyXG5cclxuICAgIC8vIFZlcmlmeSBOb2RlLmpzIGFuZCBucG0gdmVyc2lvbnMgZm9yIGNvbXBhdGliaWxpdHkgd2FybmluZ3NcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG5vZGVWZXJzaW9uID0gcHJvY2Vzcy52ZXJzaW9uO1xyXG4gICAgICBjb25zdCBucG1WZXJzaW9uID0gZXhlY1N5bmMoJ25wbSAtLXZlcnNpb24nLCB7IGVuY29kaW5nOiAndXRmOCcgfSkudHJpbSgpO1xyXG4gICAgICBcclxuICAgICAgY29uc29sZS5sb2coYCAg4oS577iPICBOb2RlLmpzIHZlcnNpb246ICR7bm9kZVZlcnNpb259YCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKGAgIOKEue+4jyAgbnBtIHZlcnNpb246ICR7bnBtVmVyc2lvbn1gKTtcclxuXHJcbiAgICAgIC8vIENoZWNrIGZvciBrbm93biBjb21wYXRpYmlsaXR5IGlzc3Vlc1xyXG4gICAgICBjb25zdCBub2RlTWFqb3IgPSBwYXJzZUludChub2RlVmVyc2lvbi5zbGljZSgxKS5zcGxpdCgnLicpWzBdKTtcclxuICAgICAgaWYgKG5vZGVNYWpvciA8IDE2KSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKCcgIOKaoO+4jyAgV2FybmluZzogTm9kZS5qcyB2ZXJzaW9uIDwgMTYgbWF5IGNhdXNlIGlzc3VlcycpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS53YXJuKCcgIOKaoO+4jyAgQ291bGQgbm90IHZlcmlmeSBucG0gdmVyc2lvbicpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEluaXRpYWxpemUgdGVzdCBkYXRhYmFzZSAoaW4tbWVtb3J5IFNRTGl0ZSBmb3IgdGVzdHMpXHJcbiAgICAvLyBUaGlzIHdvdWxkIGJlIHdoZXJlIHlvdSdkIHNldCB1cCBhIHRlc3QgZGF0YWJhc2UgaWYgbmVlZGVkXHJcbiAgICBjb25zb2xlLmxvZygnICDinIUgVGVzdCBkYXRhYmFzZSBpbml0aWFsaXplZCAoaW4tbWVtb3J5KScpO1xyXG5cclxuICAgIC8vIFNldCB1cCB0ZXN0IGVudmlyb25tZW50IHZhcmlhYmxlcyB0aGF0IG5lZWQgdG8gcGVyc2lzdFxyXG4gICAgcHJvY2Vzcy5lbnYuSkVTVF9HTE9CQUxfU0VUVVBfQ09NUExFVEUgPSAndHJ1ZSc7XHJcbiAgICBwcm9jZXNzLmVudi5URVNUX1NUQVJUX1RJTUUgPSBEYXRlLm5vdygpLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHBlcmZvcm1hbmNlIGJhc2VsaW5lIGRhdGFcclxuICAgIGNvbnN0IHBlcmZvcm1hbmNlQmFzZWxpbmUgPSB7XHJcbiAgICAgIHBpcGVsaW5lSW5pdGlhbGl6YXRpb246IDEwMCwgLy8gbXNcclxuICAgICAgYnVpbGRFeGVjdXRpb246IDUwMDAsICAgICAgICAvLyBtc1xyXG4gICAgICByZXBvcnRHZW5lcmF0aW9uOiAyMDAsICAgICAgIC8vIG1zXHJcbiAgICAgIG1lbW9yeVVzYWdlOiAxMDAgKiAxMDI0ICogMTAyNCwgLy8gMTAwTUJcclxuICAgICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgfTtcclxuXHJcbiAgICBmcy53cml0ZUZpbGVTeW5jKFxyXG4gICAgICBwYXRoLmpvaW4odGVzdERhdGFEaXIsICdwZXJmb3JtYW5jZS1iYXNlbGluZS5qc29uJyksXHJcbiAgICAgIEpTT04uc3RyaW5naWZ5KHBlcmZvcm1hbmNlQmFzZWxpbmUsIG51bGwsIDIpXHJcbiAgICApO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIHRlc3QgZW52aXJvbm1lbnRcclxuICAgIGNvbnN0IHJlcXVpcmVkRW52VmFycyA9IFtcclxuICAgICAgJ05PREVfRU5WJyxcclxuICAgICAgJ01FVFJPX1RFU1RfTU9ERScsXHJcbiAgICAgICdCVUlMRF9ISVNUT1JZX1BBVEgnLFxyXG4gICAgXTtcclxuXHJcbiAgICBjb25zdCBtaXNzaW5nRW52VmFycyA9IHJlcXVpcmVkRW52VmFycy5maWx0ZXIoXHJcbiAgICAgIGVudlZhciA9PiAhcHJvY2Vzcy5lbnZbZW52VmFyXVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAobWlzc2luZ0VudlZhcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgYE1pc3NpbmcgcmVxdWlyZWQgZW52aXJvbm1lbnQgdmFyaWFibGVzOiAke21pc3NpbmdFbnZWYXJzLmpvaW4oJywgJyl9YFxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIExvZyB0ZXN0IGNvbmZpZ3VyYXRpb24gc3VtbWFyeVxyXG4gICAgY29uc29sZS5sb2coJyAg8J+TiiBUZXN0IENvbmZpZ3VyYXRpb24gU3VtbWFyeTonKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICAgLSBUZXN0IHRpbWVvdXQ6ICR7cHJvY2Vzcy5lbnYuVEVTVF9USU1FT1VUX01TIHx8ICc2MDAwMCd9bXNgKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICAgLSBNYXggbWVtb3J5OiAke3Byb2Nlc3MuZW52Lk1BWF9NRU1PUllfTUIgfHwgJzUxMid9TUJgKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICAgLSBDSSBtb2RlOiAke3Byb2Nlc3MuZW52LkNJID09PSAndHJ1ZScgPyAnWWVzJyA6ICdObyd9YCk7XHJcbiAgICBjb25zb2xlLmxvZyhgICAgIC0gUHJvcGVydHkgdGVzdCBydW5zOiAke3Byb2Nlc3MuZW52LlBST1BFUlRZX1RFU1RfUlVOUyB8fCAnMTAwJ31gKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICAgLSBDaGFvcyBmYWlsdXJlIHJhdGU6ICR7cHJvY2Vzcy5lbnYuQ0hBT1NfRkFJTFVSRV9SQVRFIHx8ICcwLjEnfWApO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCfinIUgSmVzdCBnbG9iYWwgc2V0dXAgY29tcGxldGVkIHN1Y2Nlc3NmdWxseScpO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcign4p2MIEplc3QgZ2xvYmFsIHNldHVwIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn0iXSwidmVyc2lvbiI6M30=