9fa1665970411ecff011cec94d9bd7fe
"use strict";
/**
 * Jest Test Setup Configuration
 *
 * This setup file runs after the test framework is installed in the environment
 * but before each test file is executed.
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Custom Jest matchers
expect.extend({
    toBeWithinRange(received, floor, ceiling) {
        const pass = received >= floor && received <= ceiling;
        if (pass) {
            return {
                message: () => `expected ${received} not to be within range ${floor} - ${ceiling}`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be within range ${floor} - ${ceiling}`,
                pass: false,
            };
        }
    },
});
// Global test timeout
jest.setTimeout(60000);
// Mock console methods that are noisy during tests
const originalConsoleError = console.error;
const originalConsoleWarn = console.warn;
beforeAll(() => {
    // Suppress specific React Native warnings that are expected during tests
    console.error = (...args) => {
        if (typeof args[0] === 'string' &&
            (args[0].includes('Warning: ReactDOM.render is no longer supported') ||
                args[0].includes('Warning: componentWillMount has been renamed'))) {
            return;
        }
        originalConsoleError.call(console, ...args);
    };
    console.warn = (...args) => {
        if (typeof args[0] === 'string' &&
            (args[0].includes('Warning: componentWillReceiveProps has been renamed') ||
                args[0].includes('source.uri should not be an empty string'))) {
            return;
        }
        originalConsoleWarn.call(console, ...args);
    };
});
afterAll(() => {
    // Restore original console methods
    console.error = originalConsoleError;
    console.warn = originalConsoleWarn;
});
// Global test state cleanup
afterEach(() => {
    // Clear all mocks after each test
    jest.clearAllMocks();
    // Clear any timers
    jest.clearAllTimers();
    // Reset any global state if needed
    process.env.NODE_ENV = 'test';
});
// Performance monitoring for slow tests
const slowTestThreshold = 5000; // 5 seconds
let testStartTime;
beforeEach(() => {
    testStartTime = Date.now();
});
afterEach(() => {
    const testDuration = Date.now() - testStartTime;
    if (testDuration > slowTestThreshold) {
        console.warn(`⚠️  Slow test detected: ${expect.getState().currentTestName} took ${testDuration}ms`);
    }
});
// Memory leak detection
let initialMemoryUsage;
beforeEach(() => {
    initialMemoryUsage = process.memoryUsage();
});
afterEach(() => {
    const finalMemoryUsage = process.memoryUsage();
    const memoryGrowth = finalMemoryUsage.heapUsed - initialMemoryUsage.heapUsed;
    // Warn if memory usage grew significantly (>10MB)
    if (memoryGrowth > 10 * 1024 * 1024) {
        console.warn(`⚠️  Potential memory leak detected in ${expect.getState().currentTestName}: ` +
            `${Math.round(memoryGrowth / 1024 / 1024)}MB growth`);
    }
});
// Test flakiness detection
const testResults = new Map();
afterEach(() => {
    const testName = expect.getState().currentTestName || 'unknown';
    const testDuration = Date.now() - testStartTime;
    if (!testResults.has(testName)) {
        testResults.set(testName, []);
    }
    testResults.get(testName).push(testDuration);
    // Check for flaky tests (high variance in execution time)
    const times = testResults.get(testName);
    if (times.length >= 5) {
        const avg = times.reduce((a, b) => a + b, 0) / times.length;
        const variance = times.reduce((acc, time) => acc + Math.pow(time - avg, 2), 0) / times.length;
        const stdDev = Math.sqrt(variance);
        const coefficientOfVariation = stdDev / avg;
        // If coefficient of variation > 50%, test might be flaky
        if (coefficientOfVariation > 0.5) {
            console.warn(`⚠️  Potentially flaky test detected: ${testName} ` +
                `(CV: ${Math.round(coefficientOfVariation * 100)}%)`);
        }
    }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxLZW50aFxcRGVza3RvcFxcZWNob3RyYWlsLXByb2plY3RcXGVjaG90cmFpbFxcYXBwc1xcbW9iaWxlXFxzcmNcXF9fdGVzdHNfX1xcc2V0dXBcXGplc3Quc2V0dXAudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOztBQXVCSCx1QkFBdUI7QUFDdkIsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNaLGVBQWUsQ0FBQyxRQUFnQixFQUFFLEtBQWEsRUFBRSxPQUFlO1FBQzlELE1BQU0sSUFBSSxHQUFHLFFBQVEsSUFBSSxLQUFLLElBQUksUUFBUSxJQUFJLE9BQU8sQ0FBQztRQUN0RCxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ1QsT0FBTztnQkFDTCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQ1osWUFBWSxRQUFRLDJCQUEyQixLQUFLLE1BQU0sT0FBTyxFQUFFO2dCQUNyRSxJQUFJLEVBQUUsSUFBSTthQUNYLENBQUM7UUFDSixDQUFDO2FBQU0sQ0FBQztZQUNOLE9BQU87Z0JBQ0wsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUNaLFlBQVksUUFBUSx1QkFBdUIsS0FBSyxNQUFNLE9BQU8sRUFBRTtnQkFDakUsSUFBSSxFQUFFLEtBQUs7YUFDWixDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7Q0FDRixDQUFDLENBQUM7QUFFSCxzQkFBc0I7QUFDdEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUV2QixtREFBbUQ7QUFDbkQsTUFBTSxvQkFBb0IsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO0FBQzNDLE1BQU0sbUJBQW1CLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztBQUV6QyxTQUFTLENBQUMsR0FBRyxFQUFFO0lBQ2IseUVBQXlFO0lBQ3pFLE9BQU8sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQVcsRUFBRSxFQUFFO1FBQ2pDLElBQ0UsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssUUFBUTtZQUMzQixDQUFDLElBQUksQ0FBQyxDQUFD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RCxJQUFJLHNCQUFzQixHQUFHLEdBQUcsRUFBRSxDQUFDO1lBQ2pDLE9BQU8sQ0FBQyxJQUFJLENBQ1Ysd0NBQXdDLFFBQVEsR0FBRztnQkFDbkQsUUFBUSxJQUFJLENBQUMsS0FBSyxDQUFDLHNCQUFzQixHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQ3JELENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcS2VudGhcXERlc2t0b3BcXGVjaG90cmFpbC1wcm9qZWN0XFxlY2hvdHJhaWxcXGFwcHNcXG1vYmlsZVxcc3JjXFxfX3Rlc3RzX19cXHNldHVwXFxqZXN0LnNldHVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBKZXN0IFRlc3QgU2V0dXAgQ29uZmlndXJhdGlvblxyXG4gKiBcclxuICogVGhpcyBzZXR1cCBmaWxlIHJ1bnMgYWZ0ZXIgdGhlIHRlc3QgZnJhbWV3b3JrIGlzIGluc3RhbGxlZCBpbiB0aGUgZW52aXJvbm1lbnRcclxuICogYnV0IGJlZm9yZSBlYWNoIHRlc3QgZmlsZSBpcyBleGVjdXRlZC5cclxuICovXHJcblxyXG4vLyBJbXBvcnQgb25seSBiYXNpYyBKZXN0IGV4dGVuZGVkIG1hdGNoZXJzXHJcbi8vIFRPRE86IFJlLWVuYWJsZSBSZWFjdCBOYXRpdmUgdGVzdGluZyBsaWJyYXJ5IHdoZW4gdmVyc2lvbiBtaXNtYXRjaCBpcyByZXNvbHZlZFxyXG4vLyBpbXBvcnQgeyBjb25maWd1cmUgfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0LW5hdGl2ZSc7XHJcbi8vIGltcG9ydCAnamVzdC1leHRlbmRlZCc7IC8vIEFkZGl0aW9uYWwgbWF0Y2hlcnNcclxuXHJcbi8vIENvbmZpZ3VyZSB0ZXN0aW5nIGxpYnJhcnkgZm9yIFJlYWN0IE5hdGl2ZVxyXG4vLyBjb25maWd1cmUoe1xyXG4vLyAgIC8vIEF1dG9tYXRpY2FsbHkgY2xlYW51cCBhZnRlciBlYWNoIHRlc3RcclxuLy8gICBhc3luY1V0aWxUaW1lb3V0OiAxMDAwMCxcclxuLy8gICAvLyBBZGQgY3VzdG9tIHF1ZXJpZXMgaWYgbmVlZGVkXHJcbi8vIH0pO1xyXG5cclxuLy8gR2xvYmFsIHRlc3QgdXRpbGl0aWVzXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICBuYW1lc3BhY2UgamVzdCB7XHJcbiAgICBpbnRlcmZhY2UgTWF0Y2hlcnM8Uj4ge1xyXG4gICAgICB0b0JlV2l0aGluUmFuZ2UoZmxvb3I6IG51bWJlciwgY2VpbGluZzogbnVtYmVyKTogUjtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIEN1c3RvbSBKZXN0IG1hdGNoZXJzXHJcbmV4cGVjdC5leHRlbmQoe1xyXG4gIHRvQmVXaXRoaW5SYW5nZShyZWNlaXZlZDogbnVtYmVyLCBmbG9vcjogbnVtYmVyLCBjZWlsaW5nOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IHBhc3MgPSByZWNlaXZlZCA+PSBmbG9vciAmJiByZWNlaXZlZCA8PSBjZWlsaW5nO1xyXG4gICAgaWYgKHBhc3MpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBtZXNzYWdlOiAoKSA9PlxyXG4gICAgICAgICAgYGV4cGVjdGVkICR7cmVjZWl2ZWR9IG5vdCB0byBiZSB3aXRoaW4gcmFuZ2UgJHtmbG9vcn0gLSAke2NlaWxpbmd9YCxcclxuICAgICAgICBwYXNzOiB0cnVlLFxyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBtZXNzYWdlOiAoKSA9PlxyXG4gICAgICAgICAgYGV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIGJlIHdpdGhpbiByYW5nZSAke2Zsb29yfSAtICR7Y2VpbGluZ31gLFxyXG4gICAgICAgIHBhc3M6IGZhbHNlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH0sXHJcbn0pO1xyXG5cclxuLy8gR2xvYmFsIHRlc3QgdGltZW91dFxyXG5qZXN0LnNldFRpbWVvdXQoNjAwMDApO1xyXG5cclxuLy8gTW9jayBjb25zb2xlIG1ldGhvZHMgdGhhdCBhcmUgbm9pc3kgZHVyaW5nIHRlc3RzXHJcbmNvbnN0IG9yaWdpbmFsQ29uc29sZUVycm9yID0gY29uc29sZS5lcnJvcjtcclxuY29uc3Qgb3JpZ2luYWxDb25zb2xlV2FybiA9IGNvbnNvbGUud2FybjtcclxuXHJcbmJlZm9yZUFsbCgoKSA9PiB7XHJcbiAgLy8gU3VwcHJlc3Mgc3BlY2lmaWMgUmVhY3QgTmF0aXZlIHdhcm5pbmdzIHRoYXQgYXJlIGV4cGVjdGVkIGR1cmluZyB0ZXN0c1xyXG4gIGNvbnNvbGUuZXJyb3IgPSAoLi4uYXJnczogYW55W10pID0+IHtcclxuICAgIGlmIChcclxuICAgICAgdHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnICYmXHJcbiAgICAgIChhcmdzWzBdLmluY2x1ZGVzKCdXYXJuaW5nOiBSZWFjdERPTS5yZW5kZXIgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCcpIHx8XHJcbiAgICAgICBhcmdzWzBdLmluY2x1ZGVzKCdXYXJuaW5nOiBjb21wb25lbnRXaWxsTW91bnQgaGFzIGJlZW4gcmVuYW1lZCcpKVxyXG4gICAgKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIG9yaWdpbmFsQ29uc29sZUVycm9yLmNhbGwoY29uc29sZSwgLi4uYXJncyk7XHJcbiAgfTtcclxuXHJcbiAgY29uc29sZS53YXJuID0gKC4uLmFyZ3M6IGFueVtdKSA9PiB7XHJcbiAgICBpZiAoXHJcbiAgICAgIHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJyAmJlxyXG4gICAgICAoYXJnc1swXS5pbmNsdWRlcygnV2FybmluZzogY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyBoYXMgYmVlbiByZW5hbWVkJykgfHxcclxuICAgICAgIGFyZ3NbMF0uaW5jbHVkZXMoJ3NvdXJjZS51cmkgc2hvdWxkIG5vdCBiZSBhbiBlbXB0eSBzdHJpbmcnKSlcclxuICAgICkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBvcmlnaW5hbENvbnNvbGVXYXJuLmNhbGwoY29uc29sZSwgLi4uYXJncyk7XHJcbiAgfTtcclxufSk7XHJcblxyXG5hZnRlckFsbCgoKSA9PiB7XHJcbiAgLy8gUmVzdG9yZSBvcmlnaW5hbCBjb25zb2xlIG1ldGhvZHNcclxuICBjb25zb2xlLmVycm9yID0gb3JpZ2luYWxDb25zb2xlRXJyb3I7XHJcbiAgY29uc29sZS53YXJuID0gb3JpZ2luYWxDb25zb2xlV2FybjtcclxufSk7XHJcblxyXG4vLyBHbG9iYWwgdGVzdCBzdGF0ZSBjbGVhbnVwXHJcbmFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgLy8gQ2xlYXIgYWxsIG1vY2tzIGFmdGVyIGVhY2ggdGVzdFxyXG4gIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIFxyXG4gIC8vIENsZWFyIGFueSB0aW1lcnNcclxuICBqZXN0LmNsZWFyQWxsVGltZXJzKCk7XHJcbiAgXHJcbiAgLy8gUmVzZXQgYW55IGdsb2JhbCBzdGF0ZSBpZiBuZWVkZWRcclxuICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcclxufSk7XHJcblxyXG4vLyBQZXJmb3JtYW5jZSBtb25pdG9yaW5nIGZvciBzbG93IHRlc3RzXHJcbmNvbnN0IHNsb3dUZXN0VGhyZXNob2xkID0gNTAwMDsgLy8gNSBzZWNvbmRzXHJcbmxldCB0ZXN0U3RhcnRUaW1lOiBudW1iZXI7XHJcblxyXG5iZWZvcmVFYWNoKCgpID0+IHtcclxuICB0ZXN0U3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcclxufSk7XHJcblxyXG5hZnRlckVhY2goKCkgPT4ge1xyXG4gIGNvbnN0IHRlc3REdXJhdGlvbiA9IERhdGUubm93KCkgLSB0ZXN0U3RhcnRUaW1lO1xyXG4gIGlmICh0ZXN0RHVyYXRpb24gPiBzbG93VGVzdFRocmVzaG9sZCkge1xyXG4gICAgY29uc29sZS53YXJuKFxyXG4gICAgICBg4pqg77iPICBTbG93IHRlc3QgZGV0ZWN0ZWQ6ICR7ZXhwZWN0LmdldFN0YXRlKCkuY3VycmVudFRlc3ROYW1lfSB0b29rICR7dGVzdER1cmF0aW9ufW1zYFxyXG4gICAgKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gTWVtb3J5IGxlYWsgZGV0ZWN0aW9uXHJcbmxldCBpbml0aWFsTWVtb3J5VXNhZ2U6IE5vZGVKUy5NZW1vcnlVc2FnZTtcclxuXHJcbmJlZm9yZUVhY2goKCkgPT4ge1xyXG4gIGluaXRpYWxNZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcclxufSk7XHJcblxyXG5hZnRlckVhY2goKCkgPT4ge1xyXG4gIGNvbnN0IGZpbmFsTWVtb3J5VXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XHJcbiAgY29uc3QgbWVtb3J5R3Jvd3RoID0gZmluYWxNZW1vcnlVc2FnZS5oZWFwVXNlZCAtIGluaXRpYWxNZW1vcnlVc2FnZS5oZWFwVXNlZDtcclxuICBcclxuICAvLyBXYXJuIGlmIG1lbW9yeSB1c2FnZSBncmV3IHNpZ25pZmljYW50bHkgKD4xME1CKVxyXG4gIGlmIChtZW1vcnlHcm93dGggPiAxMCAqIDEwMjQgKiAxMDI0KSB7XHJcbiAgICBjb25zb2xlLndhcm4oXHJcbiAgICAgIGDimqDvuI8gIFBvdGVudGlhbCBtZW1vcnkgbGVhayBkZXRlY3RlZCBpbiAke2V4cGVjdC5nZXRTdGF0ZSgpLmN1cnJlbnRUZXN0TmFtZX06IGAgK1xyXG4gICAgICBgJHtNYXRoLnJvdW5kKG1lbW9yeUdyb3d0aCAvIDEwMjQgLyAxMDI0KX1NQiBncm93dGhgXHJcbiAgICApO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBUZXN0IGZsYWtpbmVzcyBkZXRlY3Rpb25cclxuY29uc3QgdGVzdFJlc3VsdHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyW10+KCk7XHJcblxyXG5hZnRlckVhY2goKCkgPT4ge1xyXG4gIGNvbnN0IHRlc3ROYW1lID0gZXhwZWN0LmdldFN0YXRlKCkuY3VycmVudFRlc3ROYW1lIHx8ICd1bmtub3duJztcclxuICBjb25zdCB0ZXN0RHVyYXRpb24gPSBEYXRlLm5vdygpIC0gdGVzdFN0YXJ0VGltZTtcclxuICBcclxuICBpZiAoIXRlc3RSZXN1bHRzLmhhcyh0ZXN0TmFtZSkpIHtcclxuICAgIHRlc3RSZXN1bHRzLnNldCh0ZXN0TmFtZSwgW10pO1xyXG4gIH1cclxuICBcclxuICB0ZXN0UmVzdWx0cy5nZXQodGVzdE5hbWUpIS5wdXNoKHRlc3REdXJhdGlvbik7XHJcbiAgXHJcbiAgLy8gQ2hlY2sgZm9yIGZsYWt5IHRlc3RzIChoaWdoIHZhcmlhbmNlIGluIGV4ZWN1dGlvbiB0aW1lKVxyXG4gIGNvbnN0IHRpbWVzID0gdGVzdFJlc3VsdHMuZ2V0KHRlc3ROYW1lKSE7XHJcbiAgaWYgKHRpbWVzLmxlbmd0aCA+PSA1KSB7XHJcbiAgICBjb25zdCBhdmcgPSB0aW1lcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIHRpbWVzLmxlbmd0aDtcclxuICAgIGNvbnN0IHZhcmlhbmNlID0gdGltZXMucmVkdWNlKChhY2MsIHRpbWUpID0+IGFjYyArIE1hdGgucG93KHRpbWUgLSBhdmcsIDIpLCAwKSAvIHRpbWVzLmxlbmd0aDtcclxuICAgIGNvbnN0IHN0ZERldiA9IE1hdGguc3FydCh2YXJpYW5jZSk7XHJcbiAgICBjb25zdCBjb2VmZmljaWVudE9mVmFyaWF0aW9uID0gc3RkRGV2IC8gYXZnO1xyXG4gICAgXHJcbiAgICAvLyBJZiBjb2VmZmljaWVudCBvZiB2YXJpYXRpb24gPiA1MCUsIHRlc3QgbWlnaHQgYmUgZmxha3lcclxuICAgIGlmIChjb2VmZmljaWVudE9mVmFyaWF0aW9uID4gMC41KSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihcclxuICAgICAgICBg4pqg77iPICBQb3RlbnRpYWxseSBmbGFreSB0ZXN0IGRldGVjdGVkOiAke3Rlc3ROYW1lfSBgICtcclxuICAgICAgICBgKENWOiAke01hdGgucm91bmQoY29lZmZpY2llbnRPZlZhcmlhdGlvbiAqIDEwMCl9JSlgXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG59KTsiXSwidmVyc2lvbiI6M30=