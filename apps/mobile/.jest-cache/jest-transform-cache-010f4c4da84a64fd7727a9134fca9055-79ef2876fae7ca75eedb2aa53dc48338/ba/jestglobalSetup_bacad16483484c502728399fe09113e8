02d62b8fe0ccc4c9e48628979746f775
"use strict";
/**
 * Jest Global Setup
 *
 * This runs once before all test suites start.
 * Use this for expensive setup operations that can be shared across tests.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = globalSetup;
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const child_process_1 = require("child_process");
async function globalSetup() {
    console.log('ðŸš€ Starting Jest global setup...');
    try {
        // Create necessary test directories
        const testDirs = [
            './tmp/test',
            './test-data',
            './reports/junit',
            './reports/html',
            './coverage',
            './.jest-cache',
        ];
        for (const dir of testDirs) {
            if (!fs.existsSync(dir)) {
                fs.mkdirSync(dir, { recursive: true });
                console.log(`  âœ… Created test directory: ${dir}`);
            }
        }
        // Create test data files
        const testDataDir = './test-data';
        // Mock build history for pipeline tests
        const mockBuildHistory = {
            builds: [
                {
                    id: 'build-1',
                    timestamp: '2024-01-01T00:00:00Z',
                    platform: 'android',
                    success: true,
                    duration: 120000,
                    bundleSize: 1024000,
                    metrics: {
                        jsSize: 500000,
                        assetsSize: 524000,
                        buildTime: 120000,
                        memoryUsage: 256000000,
                    }
                },
                {
                    id: 'build-2',
                    timestamp: '2024-01-01T01:00:00Z',
                    platform: 'ios',
                    success: true,
                    duration: 150000,
                    bundleSize: 1100000,
                    metrics: {
                        jsSize: 550000,
                        assetsSize: 550000,
                        buildTime: 150000,
                        memoryUsage: 280000000,
                    }
                }
            ],
            totalBuilds: 2,
            successRate: 1.0,
            averageDuration: 135000,
        };
        fs.writeFileSync(path.join(testDataDir, 'build-history.json'), JSON.stringify(mockBuildHistory, null, 2));
        // Mock CI configuration templates
        const mockGitHubActions = `name: EchoTrail Mobile CI
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npm test`;
        fs.writeFileSync(path.join(testDataDir, 'github-actions.yml'), mockGitHubActions);
        // Mock package.json for test projects
        const mockPackageJson = {
            name: 'test-project',
            version: '1.0.0',
            scripts: {
                build: 'metro build',
                test: 'jest',
            },
            dependencies: {
                'react-native': '^0.72.0',
                '@react-native/metro-config': '^0.72.0',
            },
            devDependencies: {
                jest: '^29.0.0',
                '@types/jest': '^29.0.0',
            }
        };
        fs.writeFileSync(path.join(testDataDir, 'package.json'), JSON.stringify(mockPackageJson, null, 2));
        // Verify Node.js and npm versions for compatibility warnings
        try {
            const nodeVersion = process.version;
            const npmVersion = (0, child_process_1.execSync)('npm --version', { encoding: 'utf8' }).trim();
            console.log(`  â„¹ï¸  Node.js version: ${nodeVersion}`);
            console.log(`  â„¹ï¸  npm version: ${npmVersion}`);
            // Check for known compatibility issues
            const nodeMajor = parseInt(nodeVersion.slice(1).split('.')[0]);
            if (nodeMajor < 16) {
                console.warn('  âš ï¸  Warning: Node.js version < 16 may cause issues');
            }
        }
        catch (error) {
            console.warn('  âš ï¸  Could not verify npm version');
        }
        // Initialize test database (in-memory SQLite for tests)
        // This would be where you'd set up a test database if needed
        console.log('  âœ… Test database initialized (in-memory)');
        // Set up test environment variables that need to persist
        process.env.JEST_GLOBAL_SETUP_COMPLETE = 'true';
        process.env.TEST_START_TIME = Date.now().toString();
        // Create performance baseline data
        const performanceBaseline = {
            pipelineInitialization: 100, // ms
            buildExecution: 5000, // ms
            reportGeneration: 200, // ms
            memoryUsage: 100 * 1024 * 1024, // 100MB
            created: new Date().toISOString(),
        };
        fs.writeFileSync(path.join(testDataDir, 'performance-baseline.json'), JSON.stringify(performanceBaseline, null, 2));
        // Note: Environment variables are set in jest.env.ts which runs before this
        console.log('  ðŸ“‹ Environment variables validated from jest.env.ts');
        console.log(`    NODE_ENV: ${process.env.NODE_ENV}`);
        console.log(`    METRO_TEST_MODE: ${process.env.METRO_TEST_MODE}`);
        console.log(`    BUILD_HISTORY_PATH: ${process.env.BUILD_HISTORY_PATH}`);
        // If variables are still missing, set defaults
        if (!process.env.NODE_ENV)
            process.env.NODE_ENV = 'test';
        if (!process.env.METRO_TEST_MODE)
            process.env.METRO_TEST_MODE = 'true';
        if (!process.env.BUILD_HISTORY_PATH)
            process.env.BUILD_HISTORY_PATH = './test-data/build-history.json';
        // Log test configuration summary
        console.log('  ðŸ“Š Test Configuration Summary:');
        console.log(`    - Test timeout: ${process.env.TEST_TIMEOUT_MS || '60000'}ms`);
        console.log(`    - Max memory: ${process.env.MAX_MEMORY_MB || '512'}MB`);
        console.log(`    - CI mode: ${process.env.CI === 'true' ? 'Yes' : 'No'}`);
        console.log(`    - Property test runs: ${process.env.PROPERTY_TEST_RUNS || '100'}`);
        console.log(`    - Chaos failure rate: ${process.env.CHAOS_FAILURE_RATE || '0.1'}`);
        console.log('âœ… Jest global setup completed successfully');
    }
    catch (error) {
        console.error('âŒ Jest global setup failed:', error);
        throw error;
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxLZW50aFxcRGVza3RvcFxcZWNob3RyYWlsLXByb2plY3RcXGVjaG90cmFpbFxcYXBwc1xcbW9iaWxlXFxzcmNcXF9fdGVzdHNfX1xcc2V0dXBcXGplc3QuZ2xvYmFsU2V0dXAudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU1ILDhCQTJLQztBQS9LRCx1Q0FBeUI7QUFDekIsMkNBQTZCO0FBQzdCLGlEQUF5QztBQUUxQixLQUFLLFVBQVUsV0FBVztJQUN2QyxPQUFPLENBQUMsR0FBRyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7SUFFaEQsSUFBSSxDQUFDO1FBQ0gsb0NBQW9DO1FBQ3BDLE1BQU0sUUFBUSxHQUFHO1lBQ2YsWUFBWTtZQUNaLGFBQWE7WUFDYixpQkFBaUI7WUFDakIsZ0JBQWdCO1lBQ2hCLFlBQVk7WUFDWixlQUFlO1NBQ2hCLENBQUM7UUFFRixLQUFLLE1BQU0sR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3hCLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7Z0JBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDcEQsQ0FBQztRQUNILENBQUM7UUFFRCx5QkFBeUI7UUFDekIsTUFBTSxXQUFXLEdBQUcsYUFBYSxDQUFDO1FBRWxDLHdDQUF3QztRQUN4QyxNQUFNLGdCQUFnQixHQUFHO1lBQ3ZCLE1BQU0sRUFBRTtnQkFDTjtvQkFDRSxFQUFFLEVBQUUsU0FBUztvQkFDYixTQUFTLEVBQUUsc0JBQXNCO29CQUNqQyxRQUFRLEVBQUUsU0FBUztvQkFDbkIsT0FBTyxFQUFFLElBQUk7b0JBQ2IsUUFBUSxFQUFFLE1BQU07b0JBQ2hCLFVBQVUsRUFBRSxPQUFP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Y3RcXGVjaG90cmFpbFxcYXBwc1xcbW9iaWxlXFxzcmNcXF9fdGVzdHNfX1xcc2V0dXBcXGplc3QuZ2xvYmFsU2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEplc3QgR2xvYmFsIFNldHVwXHJcbiAqIFxyXG4gKiBUaGlzIHJ1bnMgb25jZSBiZWZvcmUgYWxsIHRlc3Qgc3VpdGVzIHN0YXJ0LlxyXG4gKiBVc2UgdGhpcyBmb3IgZXhwZW5zaXZlIHNldHVwIG9wZXJhdGlvbnMgdGhhdCBjYW4gYmUgc2hhcmVkIGFjcm9zcyB0ZXN0cy5cclxuICovXHJcblxyXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBnbG9iYWxTZXR1cCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICBjb25zb2xlLmxvZygn8J+agCBTdGFydGluZyBKZXN0IGdsb2JhbCBzZXR1cC4uLicpO1xyXG5cclxuICB0cnkge1xyXG4gICAgLy8gQ3JlYXRlIG5lY2Vzc2FyeSB0ZXN0IGRpcmVjdG9yaWVzXHJcbiAgICBjb25zdCB0ZXN0RGlycyA9IFtcclxuICAgICAgJy4vdG1wL3Rlc3QnLFxyXG4gICAgICAnLi90ZXN0LWRhdGEnLFxyXG4gICAgICAnLi9yZXBvcnRzL2p1bml0JyxcclxuICAgICAgJy4vcmVwb3J0cy9odG1sJyxcclxuICAgICAgJy4vY292ZXJhZ2UnLFxyXG4gICAgICAnLi8uamVzdC1jYWNoZScsXHJcbiAgICBdO1xyXG5cclxuICAgIGZvciAoY29uc3QgZGlyIG9mIHRlc3REaXJzKSB7XHJcbiAgICAgIGlmICghZnMuZXhpc3RzU3luYyhkaXIpKSB7XHJcbiAgICAgICAgZnMubWtkaXJTeW5jKGRpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coYCAg4pyFIENyZWF0ZWQgdGVzdCBkaXJlY3Rvcnk6ICR7ZGlyfWApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRlc3QgZGF0YSBmaWxlc1xyXG4gICAgY29uc3QgdGVzdERhdGFEaXIgPSAnLi90ZXN0LWRhdGEnO1xyXG4gICAgXHJcbiAgICAvLyBNb2NrIGJ1aWxkIGhpc3RvcnkgZm9yIHBpcGVsaW5lIHRlc3RzXHJcbiAgICBjb25zdCBtb2NrQnVpbGRIaXN0b3J5ID0ge1xyXG4gICAgICBidWlsZHM6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBpZDogJ2J1aWxkLTEnLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiAnMjAyNC0wMS0wMVQwMDowMDowMFonLFxyXG4gICAgICAgICAgcGxhdGZvcm06ICdhbmRyb2lkJyxcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICBkdXJhdGlvbjogMTIwMDAwLFxyXG4gICAgICAgICAgYnVuZGxlU2l6ZTogMTAyNDAwMCxcclxuICAgICAgICAgIG1ldHJpY3M6IHtcclxuICAgICAgICAgICAganNTaXplOiA1MDAwMDAsXHJcbiAgICAgICAgICAgIGFzc2V0c1NpemU6IDUyNDAwMCxcclxuICAgICAgICAgICAgYnVpbGRUaW1lOiAxMjAwMDAsXHJcbiAgICAgICAgICAgIG1lbW9yeVVzYWdlOiAyNTYwMDAwMDAsXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBpZDogJ2J1aWxkLTInLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiAnMjAyNC0wMS0wMVQwMTowMDowMFonLFxyXG4gICAgICAgICAgcGxhdGZvcm06ICdpb3MnLFxyXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgIGR1cmF0aW9uOiAxNTAwMDAsXHJcbiAgICAgICAgICBidW5kbGVTaXplOiAxMTAwMDAwLFxyXG4gICAgICAgICAgbWV0cmljczoge1xyXG4gICAgICAgICAgICBqc1NpemU6IDU1MDAwMCxcclxuICAgICAgICAgICAgYXNzZXRzU2l6ZTogNTUwMDAwLFxyXG4gICAgICAgICAgICBidWlsZFRpbWU6IDE1MDAwMCxcclxuICAgICAgICAgICAgbWVtb3J5VXNhZ2U6IDI4MDAwMDAwMCxcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIF0sXHJcbiAgICAgIHRvdGFsQnVpbGRzOiAyLFxyXG4gICAgICBzdWNjZXNzUmF0ZTogMS4wLFxyXG4gICAgICBhdmVyYWdlRHVyYXRpb246IDEzNTAwMCxcclxuICAgIH07XHJcblxyXG4gICAgZnMud3JpdGVGaWxlU3luYyhcclxuICAgICAgcGF0aC5qb2luKHRlc3REYXRhRGlyLCAnYnVpbGQtaGlzdG9yeS5qc29uJyksXHJcbiAgICAgIEpTT04uc3RyaW5naWZ5KG1vY2tCdWlsZEhpc3RvcnksIG51bGwsIDIpXHJcbiAgICApO1xyXG5cclxuICAgIC8vIE1vY2sgQ0kgY29uZmlndXJhdGlvbiB0ZW1wbGF0ZXNcclxuICAgIGNvbnN0IG1vY2tHaXRIdWJBY3Rpb25zID0gYG5hbWU6IEVjaG9UcmFpbCBNb2JpbGUgQ0lcclxub246IFtwdXNoLCBwdWxsX3JlcXVlc3RdXHJcbmpvYnM6XHJcbiAgdGVzdDpcclxuICAgIHJ1bnMtb246IHVidW50dS1sYXRlc3RcclxuICAgIHN0ZXBzOlxyXG4gICAgICAtIHVzZXM6IGFjdGlvbnMvY2hlY2tvdXRAdjNcclxuICAgICAgLSB1c2VzOiBhY3Rpb25zL3NldHVwLW5vZGVAdjNcclxuICAgICAgLSBydW46IG5wbSBjaVxyXG4gICAgICAtIHJ1bjogbnBtIHRlc3RgO1xyXG5cclxuICAgIGZzLndyaXRlRmlsZVN5bmMoXHJcbiAgICAgIHBhdGguam9pbih0ZXN0RGF0YURpciwgJ2dpdGh1Yi1hY3Rpb25zLnltbCcpLFxyXG4gICAgICBtb2NrR2l0SHViQWN0aW9uc1xyXG4gICAgKTtcclxuXHJcbiAgICAvLyBNb2NrIHBhY2thZ2UuanNvbiBmb3IgdGVzdCBwcm9qZWN0c1xyXG4gICAgY29uc3QgbW9ja1BhY2thZ2VKc29uID0ge1xyXG4gICAgICBuYW1lOiAndGVzdC1wcm9qZWN0JyxcclxuICAgICAgdmVyc2lvbjogJzEuMC4wJyxcclxuICAgICAgc2NyaXB0czoge1xyXG4gICAgICAgIGJ1aWxkOiAnbWV0cm8gYnVpbGQnLFxyXG4gICAgICAgIHRlc3Q6ICdqZXN0JyxcclxuICAgICAgfSxcclxuICAgICAgZGVwZW5kZW5jaWVzOiB7XHJcbiAgICAgICAgJ3JlYWN0LW5hdGl2ZSc6ICdeMC43Mi4wJyxcclxuICAgICAgICAnQHJlYWN0LW5hdGl2ZS9tZXRyby1jb25maWcnOiAnXjAuNzIuMCcsXHJcbiAgICAgIH0sXHJcbiAgICAgIGRldkRlcGVuZGVuY2llczoge1xyXG4gICAgICAgIGplc3Q6ICdeMjkuMC4wJyxcclxuICAgICAgICAnQHR5cGVzL2plc3QnOiAnXjI5LjAuMCcsXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZnMud3JpdGVGaWxlU3luYyhcclxuICAgICAgcGF0aC5qb2luKHRlc3REYXRhRGlyLCAncGFja2FnZS5qc29uJyksXHJcbiAgICAgIEpTT04uc3RyaW5naWZ5KG1vY2tQYWNrYWdlSnNvbiwgbnVsbCwgMilcclxuICAgICk7XHJcblxyXG4gICAgLy8gVmVyaWZ5IE5vZGUuanMgYW5kIG5wbSB2ZXJzaW9ucyBmb3IgY29tcGF0aWJpbGl0eSB3YXJuaW5nc1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgbm9kZVZlcnNpb24gPSBwcm9jZXNzLnZlcnNpb247XHJcbiAgICAgIGNvbnN0IG5wbVZlcnNpb24gPSBleGVjU3luYygnbnBtIC0tdmVyc2lvbicsIHsgZW5jb2Rpbmc6ICd1dGY4JyB9KS50cmltKCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgICDihLnvuI8gIE5vZGUuanMgdmVyc2lvbjogJHtub2RlVmVyc2lvbn1gKTtcclxuICAgICAgY29uc29sZS5sb2coYCAg4oS577iPICBucG0gdmVyc2lvbjogJHtucG1WZXJzaW9ufWApO1xyXG5cclxuICAgICAgLy8gQ2hlY2sgZm9yIGtub3duIGNvbXBhdGliaWxpdHkgaXNzdWVzXHJcbiAgICAgIGNvbnN0IG5vZGVNYWpvciA9IHBhcnNlSW50KG5vZGVWZXJzaW9uLnNsaWNlKDEpLnNwbGl0KCcuJylbMF0pO1xyXG4gICAgICBpZiAobm9kZU1ham9yIDwgMTYpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJyAg4pqg77iPICBXYXJuaW5nOiBOb2RlLmpzIHZlcnNpb24gPCAxNiBtYXkgY2F1c2UgaXNzdWVzJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLndhcm4oJyAg4pqg77iPICBDb3VsZCBub3QgdmVyaWZ5IG5wbSB2ZXJzaW9uJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSB0ZXN0IGRhdGFiYXNlIChpbi1tZW1vcnkgU1FMaXRlIGZvciB0ZXN0cylcclxuICAgIC8vIFRoaXMgd291bGQgYmUgd2hlcmUgeW91J2Qgc2V0IHVwIGEgdGVzdCBkYXRhYmFzZSBpZiBuZWVkZWRcclxuICAgIGNvbnNvbGUubG9nKCcgIOKchSBUZXN0IGRhdGFiYXNlIGluaXRpYWxpemVkIChpbi1tZW1vcnkpJyk7XHJcblxyXG4gICAgLy8gU2V0IHVwIHRlc3QgZW52aXJvbm1lbnQgdmFyaWFibGVzIHRoYXQgbmVlZCB0byBwZXJzaXN0XHJcbiAgICBwcm9jZXNzLmVudi5KRVNUX0dMT0JBTF9TRVRVUF9DT01QTEVURSA9ICd0cnVlJztcclxuICAgIHByb2Nlc3MuZW52LlRFU1RfU1RBUlRfVElNRSA9IERhdGUubm93KCkudG9TdHJpbmcoKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgcGVyZm9ybWFuY2UgYmFzZWxpbmUgZGF0YVxyXG4gICAgY29uc3QgcGVyZm9ybWFuY2VCYXNlbGluZSA9IHtcclxuICAgICAgcGlwZWxpbmVJbml0aWFsaXphdGlvbjogMTAwLCAvLyBtc1xyXG4gICAgICBidWlsZEV4ZWN1dGlvbjogNTAwMCwgICAgICAgIC8vIG1zXHJcbiAgICAgIHJlcG9ydEdlbmVyYXRpb246IDIwMCwgICAgICAgLy8gbXNcclxuICAgICAgbWVtb3J5VXNhZ2U6IDEwMCAqIDEwMjQgKiAxMDI0LCAvLyAxMDBNQlxyXG4gICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIGZzLndyaXRlRmlsZVN5bmMoXHJcbiAgICAgIHBhdGguam9pbih0ZXN0RGF0YURpciwgJ3BlcmZvcm1hbmNlLWJhc2VsaW5lLmpzb24nKSxcclxuICAgICAgSlNPTi5zdHJpbmdpZnkocGVyZm9ybWFuY2VCYXNlbGluZSwgbnVsbCwgMilcclxuICAgICk7XHJcblxyXG4gICAgLy8gTm90ZTogRW52aXJvbm1lbnQgdmFyaWFibGVzIGFyZSBzZXQgaW4gamVzdC5lbnYudHMgd2hpY2ggcnVucyBiZWZvcmUgdGhpc1xyXG4gICAgY29uc29sZS5sb2coJyAg8J+TiyBFbnZpcm9ubWVudCB2YXJpYWJsZXMgdmFsaWRhdGVkIGZyb20gamVzdC5lbnYudHMnKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICAgTk9ERV9FTlY6ICR7cHJvY2Vzcy5lbnYuTk9ERV9FTlZ9YCk7XHJcbiAgICBjb25zb2xlLmxvZyhgICAgIE1FVFJPX1RFU1RfTU9ERTogJHtwcm9jZXNzLmVudi5NRVRST19URVNUX01PREV9YCk7XHJcbiAgICBjb25zb2xlLmxvZyhgICAgIEJVSUxEX0hJU1RPUllfUEFUSDogJHtwcm9jZXNzLmVudi5CVUlMRF9ISVNUT1JZX1BBVEh9YCk7XHJcbiAgICBcclxuICAgIC8vIElmIHZhcmlhYmxlcyBhcmUgc3RpbGwgbWlzc2luZywgc2V0IGRlZmF1bHRzXHJcbiAgICBpZiAoIXByb2Nlc3MuZW52Lk5PREVfRU5WKSBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcclxuICAgIGlmICghcHJvY2Vzcy5lbnYuTUVUUk9fVEVTVF9NT0RFKSBwcm9jZXNzLmVudi5NRVRST19URVNUX01PREUgPSAndHJ1ZSc7XHJcbiAgICBpZiAoIXByb2Nlc3MuZW52LkJVSUxEX0hJU1RPUllfUEFUSCkgcHJvY2Vzcy5lbnYuQlVJTERfSElTVE9SWV9QQVRIID0gJy4vdGVzdC1kYXRhL2J1aWxkLWhpc3RvcnkuanNvbic7XHJcblxyXG4gICAgLy8gTG9nIHRlc3QgY29uZmlndXJhdGlvbiBzdW1tYXJ5XHJcbiAgICBjb25zb2xlLmxvZygnICDwn5OKIFRlc3QgQ29uZmlndXJhdGlvbiBTdW1tYXJ5OicpO1xyXG4gICAgY29uc29sZS5sb2coYCAgICAtIFRlc3QgdGltZW91dDogJHtwcm9jZXNzLmVudi5URVNUX1RJTUVPVVRfTVMgfHwgJzYwMDAwJ31tc2ApO1xyXG4gICAgY29uc29sZS5sb2coYCAgICAtIE1heCBtZW1vcnk6ICR7cHJvY2Vzcy5lbnYuTUFYX01FTU9SWV9NQiB8fCAnNTEyJ31NQmApO1xyXG4gICAgY29uc29sZS5sb2coYCAgICAtIENJIG1vZGU6ICR7cHJvY2Vzcy5lbnYuQ0kgPT09ICd0cnVlJyA/ICdZZXMnIDogJ05vJ31gKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICAgLSBQcm9wZXJ0eSB0ZXN0IHJ1bnM6ICR7cHJvY2Vzcy5lbnYuUFJPUEVSVFlfVEVTVF9SVU5TIHx8ICcxMDAnfWApO1xyXG4gICAgY29uc29sZS5sb2coYCAgICAtIENoYW9zIGZhaWx1cmUgcmF0ZTogJHtwcm9jZXNzLmVudi5DSEFPU19GQUlMVVJFX1JBVEUgfHwgJzAuMSd9YCk7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ+KchSBKZXN0IGdsb2JhbCBzZXR1cCBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfinYwgSmVzdCBnbG9iYWwgc2V0dXAgZmFpbGVkOicsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufSJdLCJ2ZXJzaW9uIjozfQ==